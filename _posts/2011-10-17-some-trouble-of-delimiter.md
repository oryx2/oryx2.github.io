---
layout: post
title: 分隔符问题
category: Thinking
---
项目中经常使用竖线“|”作为分隔符，一直以来没有出现问题，像下面这样：

a|b|c|d|啊|哦|额

用的也比较多，比较简洁吧。
但今天再次使用这种方式时却遇到了问题，解析出错了，客户姓名里包含一个繁体中文“韡”(这个念wěi)。编码方式为gbk，最初以为gbk字库里没有该繁体字，google一下发现有，哎，失败。继续，后仔细看解析后的结果，发现虽然“韡”解为乱码，但之后的一项正确解析了，只是最后的数据少了一项，就感觉“韡”中间包含了一个竖线似的。没办法，反编译看看吧，发现项目是拿字节去比较，然后截取的，于是怀疑“韡”中的某位字节与“|”线的字节相等，测试一下果然，“韡” gbk下的字节为ED7C,而竖线的字节为7C,ou出问题了。
将编码改为UTF-8,解决之。
过后我在想，UTF-8编码难道不会出现这种情况，遂又查询了一下UTF-8编码方式，如下:

Unicode符号范围 | UTF-8编码方式
(十六进制) | （二进制）
--------------------+---------------------------------------------
0000 0000-0000 007F | 0xxxxxxx

0000 0080-0000 07FF | 110xxxxx 10xxxxxx

0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx

0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx

汉字在第二行或第三行，竖线在第一行，007C，可以看出汉字的字节数组中不会存在第一行中的字节，故不会出现上述问题。

其实还有疑问，分隔时为什么按字节截取，而不是按字符截取，哎，以后再想吧。